<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src='https://code.jquery.com/jquery-1.12.4.js'></script>
    <script src='https://code.jquery.com/ui/1.12.1/jquery-ui.js'></script>
    <script>
        const url = 'http://1bdd-2800-2245-9000-4b4-6e25-e5b2-b951-4c59.ngrok-free.app';

        window.onload = function() {
            $('#popUp').hide();
            getStudents();
        }

        //Promesas

        function loadStudents(){
            return new Promise(function(resolve, reject){
                var request = new XMLHttpRequest();
                request.open('GET', url + '/student/getAll');
                request.responseType = 'json';
                request.onload = function(){
                    if(request.status == 200){
                        resolve(request.response);
                    }
                    else{
                        reject(Error('Error' + request.statusText));
                    }
                }
                request.onerror = function(){
                    reject(Error("Error network"));
                }
                request.send();
            });
        }

        //Funciones que consumen las promesas

        function getStudents() {

            loadStudents()
                .then((response) => {
                    var tbody = document.querySelector('tbody');
                    tbody.innerHTML = '';
                    response.forEach(e => {
                        var row = tbody.insertRow();
                        var id = row.insertCell();
                        id.innerHTML = e.id;
                        var dni = row.insertCell();
                        dni.innerHTML = e.dni;
                        var lastName = row.insertCell();
                        lastName.innerHTML = e.lastName;
                        var firstName = row.insertCell();
                        firstName.innerHTML = e.firstName;
                        var email = row.insertCell();
                        email.innerHTML = e.email;
                        var student = JSON.stringify({
                            'id': e.id,
                            'dni': e.dni,
                            'lasName': e.lastName,
                            'firstName': e.firstName,
                            'email': e.email,
                        })
                        var view = row.insertCell();
                        view.innerHTML = '<button onclick="viewStudent('+student+')">View</button>';
                        var del = row.insertCell();
                        del.innerHTML = "<button onclick='deleteStudent("+e.id+")'>Delete</button>";
                    });
                    document.getElementById('id').value = '';
                    document.getElementById('lastName').value = '';
                    document.getElementById('firstName').value = '';
                    document.getElementById('email').value = '';
                    document.getElementById('dni').focus();
                })
                .catch((reason) => {
                    console.log(Error(reason))
                });
        };
        
    </script>
</head>
<body>
    <table style='border: 1px solid'>
        <thead>
            <tr>
                <th style='text-align: left'>Id</th>
                <th style='text-align: left'>DNI</th>
                <th style='text-align: left'>Last Name</th>
                <th style='text-align: left'>First Name</th>
                <th style='text-align: left'>Email</th>
            </tr>
        </thead>
        <tbody>      
        </tbody>
        <tfoot>
            <tr>
                <td></td>
                <td><input id="dni" /></td>
                <td><input id="lastName" /></td>
                <td><input id="firstName" /></td>
                <td><input id="email" /></td>
                <td colspan='2' style='text-align: center'><button onclick="saveStudent()">Add</button></td>
            </tr>
        </tfoot>
    </table>
</body>
</html>